# Harness Chaos Experiment Importer - harness_chaos_bulk_importer.py

This Python script automates the process of importing **Chaos Experiments** into target Harness Infrastructures from existing templates available in a specified **Chaos Hub**.

It leverages the Harness Chaos Manager APIs to:
1. Fetch all experiment templates from a Chaos Hub.
2. Automatically create versions of those experiments in the specified environment and infrastructure.
3. Assign a unique identifier to each imported experiment to prevent name collisions.

---

## üìò Author
**Shashank Dwivedi**  
*Senior Technical Program Manager, Harness*

---

## üß© Prerequisites

Before running the script, ensure you have:
- Python 3.7 or higher installed
- `requests` library installed (`pip install requests`)
- A valid **Harness API Key** with access to Chaos Manager APIs
- The necessary **environment variables** configured

---

## ‚öôÔ∏è Environment Variables

The script reads required configuration from environment variables. All of the following must be set:

| Variable      | Description |
|----------------|-------------|
| `ACCOUNT_ID`   | Harness account identifier |
| `ORG_ID`       | Organization identifier where the experiments will be created |
| `PROJECT_ID`   | Project identifier inside which experiments are created |
| `ENV_ID`       | Environment identifier |
| `INFRA_ID`     | Infrastructure identifier linked to the environment |
| `CHAOSHUB_ID`  | Chaos Hub identifier from which templates should be fetched |
| `API_TOKEN`    | Harness API Token with access to Chaos Manager |

### Example (Linux/macOS)
```bash
export API_TOKEN="your_api_key"
export ACCOUNT_ID="your_account_id"
export ORG_ID="default"
export PROJECT_ID="chaos-project"
export ENV_ID="chaos-env"
export INFRA_ID="chaos-k8s-infra"
export CHAOSHUB_ID="my-chaoshub"
```

---

## üöÄ Usage

Run the script directly once all environment variables are set:

```bash
python import_chaos_experiments.py
```

You should see output similar to:

```text
--- Starting Import Process ---
Target: Org=default, Proj=chaos-project, Infra=chaos-env/chaos-k8s-infra
Fetching templates from Hub: my-chaoshub...
Found X templates. Beginning import...
Importing Template: pod-delete -> New Name: pod-delete-1a2b3c4d
‚úÖ Success: pod-delete-1a2b3c4d
...
```

---

## üîç What the Script Does

1. **Validates Environment Variables**  
   The script validates that all required environment variables are present before proceeding. If any are missing, the script exits with an error.

2. **Fetches Experiment Templates**  
   It calls the Harness Chaos Manager API to retrieve all experiment templates in the specified `CHAOSHUB_ID`.

3. **Creates Experiments in Target Infra**  
   For each template, it launches a new Chaos Experiment into the target `ENV_ID/INFRA_ID` pair.

4. **Avoids Name Collisions**  
   Each new experiment name is generated by appending an 8-character UUID suffix to the original template identity.

---

## üîê Security Notes

- Do **not** hardcode API tokens in the script. Always use environment variables or a secure secrets manager.
- Rotate your `API_TOKEN` regularly according to your organization‚Äôs security policies.
- If you are committing this script to a repository, ensure that no sensitive values are present in the code or example commands.

---

## ‚ö†Ô∏è Troubleshooting

- **Missing environment variables**  
  The script will print which variables are missing and exit. Set them and re-run.

- **API/Network Errors**  
  The script prints descriptive error messages for HTTP and network failures (e.g., invalid token, connectivity issues).

- **No templates found**  
  If the specified `CHAOSHUB_ID` has no templates, the script will inform you and exit gracefully.

---

## üß™ Notes

- This script uses `verify=False` for HTTPS requests to the Harness endpoint. In a production environment, consider enabling certificate verification or configuring a proper CA bundle.
- You can further extend this script to filter templates, tag experiments, or add advanced metadata depending on your use case.


# Harness Chaos Experiment Bulk Importer - create_experiments_template.py

**Author**: Shashank Dwivedi, Senior Technical Program Manager, Harness

This automation script facilitates the **bulk propagation of Chaos Experiment Templates** across an entire Harness Account. It traverses the account hierarchy (Organizations ‚Üí Projects ‚Üí Environments ‚Üí Infrastructures), identifies infrastructures where **Chaos V2 is enabled**, and automatically imports/launches experiments from a Account Scoped Chaos Hub.

---

## üöÄ Capabilities

* **Deep Discovery**: Recursively fetches all Organizations, Projects, and Environments within the account.
* **Smart Filtering**: Targets only infrastructures where the Harness Chaos (V2) module is explicitly enabled (`isChaosEnabled=True`).
* **Bulk Instantiation**: Fetches all templates from a specific **Chaos Hub** and instantiates them as experiments in the target projects.

---

## üìã Prerequisites

* **Python 3.6+**
* **Harness Account Access**:
    * Account Identifier
    * API Key (Personal Access Token or Service Account Token) with permissions to:
        * Read Organizations, Projects, and Environments.
        * Create and Manage Chaos Experiments.
* **Dependencies**:
    ```bash
    pip install requests
    ```

---

## ‚öôÔ∏è Configuration

Before running the script, open `create_experiments_template.py` and configure the following global variables:

### 1. Authentication & Account
Update the credentials at the top of the file:

```python
# Your Harness Account ID (found in URL or Account Settings)
ACCOUNT_IDENTIFIER = 'SxuV0ChbRqWGSYClFlMQMQ'

# Your Harness API Token (Keep this secret!)
API_TOKEN = "<Your Token>"
